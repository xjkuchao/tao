---
description: 性能优化指南
globs:
    - "crates/tao-codec/**/*.rs"
    - "crates/tao-format/**/*.rs"
    - "crates/tao-scale/**/*.rs"
---

# 性能优化

## 内存管理

- 避免不必要的内存分配, 优先使用引用和借用
- 帧缓冲区应支持复用, 避免每帧都重新分配内存
- 大块数据使用 `bytes::Bytes` 实现零拷贝传递

## 数据处理

- 大量数据处理使用迭代器而非收集到 `Vec` 后再遍历
- 像素格式转换和编解码热路径应尽量避免分支预测失败
- 考虑使用 SIMD 指令优化关键路径 (通过 `std::arch` 或 `packed_simd`)

## 性能测试

- 使用 `benches/` 目录编写基准测试
- 使用 `cargo bench` 测量性能
- 关注热路径的性能表现
- 使用 profiler 工具分析性能瓶颈
