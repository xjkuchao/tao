# MPEG-4 Part 2 è§£ç å™¨å®Œå–„è®¡åˆ’ â€” 100% FFmpeg å¯¹æ ‡

> æ—¥æœŸ: 2026-02-16
> çŠ¶æ€: æ‰§è¡Œä¸­
> ç›®æ ‡: ä½¿ tao çš„ MPEG-4 Part 2 è§£ç å™¨è¾“å‡ºä¸ FFmpeg åƒç´ çº§ä¸€è‡´, å…¼å®¹æ€§/ç¨³å¥æ€§/æ€§èƒ½è¾¾åˆ°åŒç­‰æ°´å¹³

---

## 0. èƒŒæ™¯ä¸ç°çŠ¶

### 0.1 å½“å‰å®ç°æ¦‚å†µ

è§£ç å™¨ä½äº `crates/tao-codec/src/decoders/mpeg4/`, å…± 12 ä¸ªæ–‡ä»¶, ~3,894 è¡Œä»£ç .

| æ–‡ä»¶         | è¡Œæ•° | åŠŸèƒ½                                      |
| ------------ | ---- | ----------------------------------------- |
| mod.rs       | 1271 | ä¸»è§£ç å™¨, I/P/B å¸§è§£ç , å®å—è§£ç å¾ªç¯      |
| vlc.rs       | 755  | VLC è¡¨ (MCBPC/CBPY/DC/MVD/AC), O(1) æŸ¥è¡¨  |
| bframe.rs    | 372  | B å¸§: Direct/Forward/Backward/Interpolate |
| motion.rs    | 344  | MV è§£ç /é¢„æµ‹, åŠåƒç´ /å››åˆ†åƒç´ è¿åŠ¨è¡¥å¿     |
| header.rs    | 311  | VOL/VOP å¤´è§£æ                            |
| bitreader.rs | 160  | æ¯”ç‰¹æµè¯»å–å™¨                              |
| gmc.rs       | 134  | GMC ç²¾çµè½¨è¿¹è§£ç                           |
| block.rs     | 130  | 8x8 å— DCT ç³»æ•°è§£ç , AC/DC é¢„æµ‹           |
| tables.rs    | 120  | é‡åŒ–çŸ©é˜µ, æ‰«æè¡¨, DC ç¼©æ”¾å› å­             |
| types.rs     | 118  | ç±»å‹å®šä¹‰                                  |
| idct.rs      | 100  | æ•´æ•° IDCT (Chen-Wang ç®—æ³•)                |
| dequant.rs   | 79   | H.263/MPEG åé‡åŒ–                         |

### 0.2 å·²å®ç°åŠŸèƒ½ âœ…

- I/P/B å¸§è§£ç  (B: Direct/Forward/Backward/Interpolate æ¨¡å¼)
- VOL/VOP å¤´éƒ¨è§£æ
- å®Œæ•´ VLC è§£ç  (Escape Mode 1/2/3), O(1) å¿«é€ŸæŸ¥è¡¨
- H.263 å’Œ MPEG ä¸¤ç§åé‡åŒ–
- DC ç¼©æ”¾å› å­ (æ ‡å‡† Table 7-1)
- åŠåƒç´ /å››åˆ†åƒç´ è¿åŠ¨è¡¥å¿ (6-tap FIR)
- è‰²åº¦ MV å¯¼å‡º (å« rounding è¡¨)
- MV èŒƒå›´ wrapping
- AC/DC é¢„æµ‹
- äº¤æ›¿æ‰«æè¡¨
- å¤±é…æ§åˆ¶ (MPEG é‡åŒ–ç±»å‹)
- è¾¹ç¼˜æ‰©å±•
- Resync marker æ£€æµ‹
- æ•´æ•° IDCT (Chen-Wang å®šç‚¹ç®—æ³•)

### 0.3 å‚è€ƒå¯¹æ¯”: FFmpeg vs Xvid

| ç‰¹æ€§                    | FFmpeg (mpeg4videodec.c) | Xvid (libxvidcore) | tao å½“å‰         |
| ----------------------- | ------------------------ | ------------------ | ---------------- |
| Simple Profile          | âœ… å®Œæ•´                  | âœ… å®Œæ•´            | âš ï¸ éƒ¨åˆ†          |
| Advanced Simple Profile | âœ… å®Œæ•´                  | âœ… å®Œæ•´            | âš ï¸ éƒ¨åˆ†          |
| B å¸§                    | âœ… å®Œæ•´                  | âœ… å®Œæ•´            | âš ï¸ æœ‰ bug        |
| å››åˆ†åƒç´  MC             | âœ… ç²¾ç¡®                  | âœ… ç²¾ç¡®            | âš ï¸ rounding å·®å¼‚ |
| GMC (S-VOP)             | âœ… 1/2/3 ç‚¹              | âœ… 1/2/3 ç‚¹        | âŒ æœªé›†æˆ        |
| äº¤é”™æ‰«æ (Interlaced)   | âœ… åœºé¢„æµ‹+åœº DCT         | âœ… åœºé¢„æµ‹+åœº DCT   | âŒ ä»…è§£æ        |
| RVLC åå‘è§£ç            | âœ… å®Œæ•´                  | âœ… å®Œæ•´            | âŒ å‰å‘å›é€€      |
| Data Partitioning       | âœ… å®Œæ•´                  | âœ… å®Œæ•´            | âŒ å­—èŠ‚å¯å‘å¼    |
| AC/DC é¢„æµ‹              | âœ… æŒ‰æ ‡å‡†                | âœ… æŒ‰æ ‡å‡†          | âŒ æ‰«æè¡¨é”™è¯¯    |
| IDCT ç²¾åº¦               | âœ… IEEE 1180 åˆè§„        | âœ… IEEE 1180 åˆè§„  | âš ï¸ Â±1-2 LSB      |
| åé‡åŒ–è£å‰ª              | âœ… [-2048, 2047]         | âœ… [-2048, 2047]   | âŒ ç¼ºå¤±          |
| complexity_estimation   | âœ… å®Œæ•´è§£æ              | âœ… å®Œæ•´è§£æ        | âŒ æœªè§£æ        |
| å¸§é‡æ’åº (B å¸§ DPB)     | âœ…                       | âœ…                 | âŒ               |
| é”™è¯¯æ¢å¤                | âœ… resync + slice        | âœ… resync + slice  | âš ï¸ åŸºç¡€          |

---

## 1. å‘ç°çš„é—®é¢˜ â€” æŒ‰ä¸¥é‡æ€§æ’åˆ—

### 1.1 å…³é”® Bug (ğŸ”´ ä¼šäº§ç”Ÿå¯è§é”™è¯¯è¾“å‡º)

| #   | æ¨¡å—      | ä½ç½®                  | é—®é¢˜æè¿°                                                                                     |
| --- | --------- | --------------------- | -------------------------------------------------------------------------------------------- |
| C1  | header.rs | L133                  | `complexity_estimation` æœªè§£æ â€” `complexity_disable == false` æ—¶åç»­æ‰€æœ‰ VOL å­—æ®µä½åç§»é”™è¯¯ |
| C2  | block.rs  | L56-77                | AC é¢„æµ‹ä½¿ç”¨äº†é”™è¯¯çš„æ‰«æä½ç½® â€” å‚ç›´é¢„æµ‹åº”ä½¿ç”¨äº¤æ›¿æ°´å¹³æ‰«æ, æ°´å¹³é¢„æµ‹åº”ä½¿ç”¨äº¤æ›¿å‚ç›´æ‰«æ         |
| C3  | motion.rs | L72-82                | Inter4V block 0 MV é¢„æµ‹ä½¿ç”¨äº†é”™è¯¯çš„é‚»å±…                                                      |
| C4  | mod.rs    | L958 + header.rs L155 | S-VOP æ˜ å°„ä¸º I å¸§ â†’ GMC è¿åŠ¨è¡¥å¿ä»æœªåº”ç”¨                                                     |
| C5  | header.rs | L100                  | `sprite_enable` å›ºå®šè¯» 1 bit â€” `verid >= 2` æ—¶åº”è¯» 2 bits                                    |
| C6  | mod.rs    | L623-637              | P å¸§è‰²åº¦ MC ç¼ºå°‘å››åˆ†åƒç´ æ„ŸçŸ¥                                                                 |
| C7  | bframe.rs | L169                  | Direct æ¨¡å¼è‰²åº¦ MV ä½¿ç”¨ 1MV å¯¼å‡º â€” åº”ä½¿ç”¨ 4MV å¯¼å‡º                                           |

### 1.2 ä¸­ç­‰é—®é¢˜ (ğŸŸ  ç»†å¾®è´¨é‡åŠ£åŒ–)

| #   | æ¨¡å—       | ä½ç½®     | é—®é¢˜æè¿°                                                   |
| --- | ---------- | -------- | ---------------------------------------------------------- |
| M1  | dequant.rs | L30-40   | H.263 åé‡åŒ–åç¼ºå°‘ [-2048, 2047] è£å‰ª                      |
| M2  | dequant.rs | L54-56   | MPEG åé‡åŒ–çš„ mismatch control ä»…å¯¹ Inter å—æ‰§è¡Œ           |
| M3  | block.rs   | L60-77   | AC é¢„æµ‹å€¼åŠ æ³•åç¼ºå°‘ [-2048, 2047] è£å‰ª                     |
| M4  | idct.rs    | æ•´ä¸ªæ–‡ä»¶ | è¡Œå˜æ¢ç¼ºå°‘ rounding (+1024), è¶å½¢ç»“æ„éæ ‡å‡†, Â±1-2 LSB è¯¯å·® |
| M5  | motion.rs  | L198-270 | qpel MC rounding è¡Œä¸ºä¸æ ‡å‡†/FFmpeg ä¸ä¸€è‡´                  |

### 1.3 ç¼ºå¤±åŠŸèƒ½ (ğŸŸ¡ ç‰¹å®šæµæ— æ³•æ’­æ”¾)

| #   | æ¨¡å—      | é—®é¢˜æè¿°                                     |
| --- | --------- | -------------------------------------------- |
| F1  | gmc.rs    | 2/3 ç‚¹ GMC ä»…ç®€åŒ–ä¸ºå¹³ç§», æ— ä»¿å°„/é€è§†å˜æ¢     |
| F2  | bframe.rs | äº¤é”™åœºé¢„æµ‹ (field_for_top/bot) æœªå®ç°        |
| F3  | mod.rs    | B å¸§æ— å¸§é‡æ’åº                               |
| F4  | vlc.rs    | RVLC åå‘è§£ç æœªå®ç°                          |
| F5  | mod.rs    | Data Partitioning åˆ†æä¸ºå­—èŠ‚çº§å¯å‘å¼         |
| F6  | header.rs | ç¼ºå°‘ `alternate_vertical_scan_flag` VOP è§£æ |

---

## 2. æµ‹è¯•æ ·æœ¬è§„åˆ’

### 2.1 ç°æœ‰æ ·æœ¬

| æ ·æœ¬                  | URL                                                               | ç‰¹æ€§                  |
| --------------------- | ----------------------------------------------------------------- | --------------------- |
| mpeg4_avi.avi         | `https://samples.ffmpeg.org/V-codecs/MPEG4/mpeg4_avi.avi`         | æ ‡å‡† MPEG-4, AVI å®¹å™¨ |
| data_partitioning.avi | `https://samples.ffmpeg.org/V-codecs/MPEG4/data_partitioning.avi` | Data Partitioning     |

### 2.2 éœ€è¦æ–°å¢çš„æ ·æœ¬

æ¯ä¸ªé˜¶æ®µå¼€å§‹å‰éœ€ä» https://samples.ffmpeg.org/ æŸ¥æ‰¾å¹¶éªŒè¯ (`ffprobe <URL>`) ä»¥ä¸‹ç±»å‹çš„æ ·æœ¬:

| éœ€æ±‚            | æœç´¢è·¯å¾„å»ºè®®                       | ç”¨é€”           |
| --------------- | ---------------------------------- | -------------- |
| B å¸§ MPEG-4     | `V-codecs/MPEG4/` æˆ– `mov/` ç›®å½•   | B å¸§è§£ç æ­£ç¡®æ€§ |
| å››åˆ†åƒç´  MPEG-4 | `V-codecs/MPEG4/` ç›®å½•             | qpel MC æµ‹è¯•   |
| GMC/S-VOP       | `V-codecs/MPEG4/` æˆ– `DivX/` ç›®å½•  | GMC è¿åŠ¨è¡¥å¿   |
| äº¤é”™ MPEG-4     | `V-codecs/MPEG4/` æˆ– `MPEG4/` ç›®å½• | åœºé¢„æµ‹+åœº DCT  |
| DivX ç¼–ç        | `DivX/` ç›®å½•                       | DivX å…¼å®¹æ€§    |
| Xvid ç¼–ç        | `V-codecs/MPEG4/` æˆ–ç”¨æˆ·ç”Ÿæˆ       | Xvid å…¼å®¹æ€§    |
| å¤šç§ profile    | `V-codecs/MPEG4/` å„å­ç›®å½•         | è¾¹ç•Œæƒ…å†µè¦†ç›–   |

> æ¯ä¸ªé˜¶æ®µçš„ç¬¬ä¸€æ­¥æ“ä½œæ˜¯: æµè§ˆ https://samples.ffmpeg.org/V-codecs/MPEG4/ å’Œ https://samples.ffmpeg.org/allsamples.txt æœç´¢ mpeg4/MPEG4/divx/xvid, æ‰¾åˆ°åˆé€‚æ ·æœ¬, `ffprobe` éªŒè¯åæ·»åŠ åˆ° `samples/SAMPLE_URLS.md`

---

## 3. æ‰§è¡Œé˜¶æ®µ

### é˜¶æ®µ 1: VOL/VOP å¤´éƒ¨è§£æä¿®å¤ (ğŸ”´ æœ€é«˜ä¼˜å…ˆ)

**ç›®æ ‡**: ä¿®å¤å¤´éƒ¨è§£æé”™è¯¯, ç¡®ä¿æ‰€æœ‰åç»­å­—æ®µæ­£ç¡®è¯»å–

**ä¿®å¤é¡¹**:

1. **å®ç° `complexity_estimation` å®Œæ•´è§£æ** â€” `crates/tao-codec/src/decoders/mpeg4/header.rs`
    - å‚è€ƒ ISO 14496-2 Â§6.3.5 å’Œ FFmpeg `ff_mpeg4_decode_picture_header()` ä¸­ `decode_vol_header()` çš„ `complexity_estimation` åˆ†æ”¯
    - è§£æ `estimation_method`, æ ¹æ®æ–¹æ³•è·³è¿‡å¯¹åº”å­—æ®µ
    - å­˜å‚¨åˆ° `VolInfo` ä¸­ (å³ä½¿ä¸ä½¿ç”¨, ä¹Ÿå¿…é¡»æ­£ç¡®è·³è¿‡æ¯”ç‰¹)

2. **ä¿®å¤ `sprite_enable` æ¯”ç‰¹å®½åº¦** â€” `header.rs`
    - åœ¨ `VolInfo` ä¸­å¢åŠ  `video_object_layer_verid` å­—æ®µ
    - `sprite_enable`: `verid >= 2` æ—¶è¯» 2 bits, å¦åˆ™è¯» 1 bit

3. **è§£æ VOP `alternate_vertical_scan_flag`** â€” `header.rs`
    - åœ¨ P-VOP å’Œ B-VOP ä¸­è¯»å–è¯¥æ ‡å¿—å¹¶å†™å…¥ `VopInfo`

4. **ä¿®å¤ S-VOP ç±»å‹æ˜ å°„** â€” `header.rs`
    - `vop_coding_type == 3` æ˜ å°„ä¸º `PictureType::S`
    - åœ¨ `VopInfo` å¢åŠ  `is_sprite: bool` å­—æ®µ

**æµ‹è¯•ç”¨ä¾‹ (é˜¶æ®µ 1)**:

```
- test_vol_header_parse_basic
- test_vol_header_complexity_estimation
- test_vop_header_svop_detection
- test_vol_header_sprite_enable_verid2
```

**éªŒæ”¶æ ‡å‡†**: å¤´éƒ¨è§£ææµ‹è¯•å…¨éƒ¨é€šè¿‡, è§£ç å‰ 5 å¸§æ— å´©æºƒ

---

### é˜¶æ®µ 2: AC/DC é¢„æµ‹ä¸åé‡åŒ–ä¿®å¤ (ğŸ”´ é«˜ä¼˜å…ˆ)

**çŠ¶æ€**: âœ… å·²å®Œæˆ 2026-02-16

**ç›®æ ‡**: ä¿®æ­£ DCT ç³»æ•°åŸŸçš„é¢„æµ‹å’Œé‡åŒ–é”™è¯¯

**ä¿®å¤é¡¹**:

1. **ä¿®å¤ AC é¢„æµ‹æ‰«æè¡¨é€‰æ‹©** â€” `block.rs`
2. **AC é¢„æµ‹åè£å‰ª** â€” `block.rs`
3. **H.263 åé‡åŒ–åè£å‰ª** â€” `dequant.rs`
4. **MPEG åé‡åŒ– mismatch control æ‰©å±•åˆ° Intra å—** â€” `dequant.rs`

**æµ‹è¯•ç”¨ä¾‹ (é˜¶æ®µ 2)**:

```
- test_ac_prediction_vertical_direction
- test_ac_prediction_horizontal_direction
- test_ac_prediction_clipping
- test_dequant_h263_clipping
- test_dequant_mpeg_mismatch_intra
- test_mpeg4_decode_basic_pixel_check
```

---

### é˜¶æ®µ 3: IDCT ç²¾åº¦æå‡ (ğŸŸ  ä¸­ç­‰ä¼˜å…ˆ)

**ç›®æ ‡**: IDCT é€šè¿‡ IEEE 1180 åˆè§„æµ‹è¯•

**ä¿®å¤é¡¹**:

- æ›¿æ¢ä¸º IEEE 1180 åˆè§„ IDCT (FFmpeg æˆ– Xvid æ–¹æ¡ˆ)

**æµ‹è¯•ç”¨ä¾‹ (é˜¶æ®µ 3)**:

```
- test_idct_ieee1180_random
- test_idct_ieee1180_sparse
- test_idct_known_values
- test_mpeg4_iframe_psnr_improvement
```

---

### é˜¶æ®µ 4: è¿åŠ¨è¡¥å¿ä¿®å¤ (ğŸ”´ é«˜ä¼˜å…ˆ)

**ç›®æ ‡**: P å¸§è¿åŠ¨è¡¥å¿åƒç´ ç²¾åº¦ä¸ FFmpeg ä¸€è‡´

**ä¿®å¤é¡¹**:

1. ä¿®å¤ Inter4V block 0 MV é¢„æµ‹
2. P å¸§è‰²åº¦ MC å››åˆ†åƒç´ æ„ŸçŸ¥
3. qpel MC rounding ä¿®æ­£
4. MVD è§£ç ä¼˜åŒ– (æ€§èƒ½)

---

### é˜¶æ®µ 5: B å¸§ä¿®å¤ä¸å¸§é‡æ’åº (ğŸ”´ é«˜ä¼˜å…ˆ)

**ç›®æ ‡**: B å¸§åƒç´ ç²¾ç¡®, è¾“å‡ºé¡ºåºä¸ FFmpeg ä¸€è‡´

**ä¿®å¤é¡¹**:

1. Direct æ¨¡å¼è‰²åº¦ MV ä¿®å¤
2. Direct æ¨¡å¼ MV è®¡ç®—éªŒè¯
3. B å¸§å¸§é‡æ’åº (DPB)

---

### é˜¶æ®µ 6: GMC (S-VOP) å®ç° (ğŸŸ¡ ä¸­ç­‰ä¼˜å…ˆ)

**ç›®æ ‡**: å®Œæ•´å®ç° GMC 1/2/3 ç‚¹è¿åŠ¨è¡¥å¿

---

### é˜¶æ®µ 7: é«˜çº§åŠŸèƒ½å®Œå–„ (ğŸŸ¡ è¾ƒä½ä¼˜å…ˆ)

**ç›®æ ‡**: å®Œå–„ RVLC, Data Partitioning, äº¤é”™æ‰«æç­‰é«˜çº§ç‰¹æ€§

---

### é˜¶æ®µ 8: æ€§èƒ½ä¼˜åŒ–ä¸ 100% å¯¹æ ‡éªŒè¯ (ğŸŸ¢ æœ€ç»ˆé˜¶æ®µ)

**ç›®æ ‡**: è¾¾åˆ° FFmpeg åŒç­‰æ€§èƒ½, 100% åƒç´ çº§ä¸€è‡´

---

## 4. ä¾èµ–å…³ç³»å›¾

```
é˜¶æ®µ 1 (å¤´éƒ¨è§£æ)
  |
  |--> é˜¶æ®µ 2 (AC/DC é¢„æµ‹ + åé‡åŒ–)
  |      |
  |      |--> é˜¶æ®µ 3 (IDCT ç²¾åº¦)
  |             |
  |             |--> é˜¶æ®µ 4 (è¿åŠ¨è¡¥å¿) --> é˜¶æ®µ 5 (B å¸§) --> é˜¶æ®µ 8 (æ€§èƒ½+éªŒè¯)
  |                                                              ^
  |--> é˜¶æ®µ 6 (GMC) --------------------------------------------|
                                                                 ^
       é˜¶æ®µ 7 (é«˜çº§åŠŸèƒ½) --------------------------------------|
```

---

## 9. è¿›åº¦è¿½è¸ª

| é˜¶æ®µ                   | çŠ¶æ€      | å®Œæˆæ—¥æœŸ   | å¤‡æ³¨                                                                |
| ---------------------- | --------- | ---------- | ------------------------------------------------------------------- |
| é˜¶æ®µ 1: å¤´éƒ¨è§£æ       | âœ… å·²å®Œæˆ | 2026-02-16 | VOL/VOP å¤´è§£æä¿®å¤ä¸æµ‹è¯•è¡¥å……                                        |
| é˜¶æ®µ 2: AC/DC + åé‡åŒ– | âœ… å·²å®Œæˆ | 2026-02-16 | AC é¢„æµ‹æ‰«æè¡¨ä¿®å¤ï¼Œè£å‰ªå®ç°ï¼Œmismatch control æ‰©å±•                  |
| é˜¶æ®µ 3: IDCT           | âœ… å·²å®Œæˆ | 2026-02-16 | IEEE 1180 å…¼å®¹ IDCTï¼Œæ·»åŠ è¡Œ/åˆ—å˜æ¢ rounding (+1024)                 |
| é˜¶æ®µ 4: è¿åŠ¨è¡¥å¿       | âœ… å·²å®Œæˆ | 2026-02-16 | P å¸§è‰²åº¦ MC å››åˆ†åƒç´ æ„ŸçŸ¥ï¼ŒB å¸§ Direct æ¨¡å¼è‰²åº¦ MV 4MV å¯¼å‡º          |
| é˜¶æ®µ 5: B å¸§           | âœ… å·²å®Œæˆ | 2026-02-16 | B å¸§è§£ç å›¾åƒç¼“å†²åŒºï¼ˆDPBï¼‰å®ç°ï¼Œæ”¯æŒå¸§é‡æ’åº                         |
| é˜¶æ®µ 6: GMC            | âš ï¸ éƒ¨åˆ†   | 2026-02-16 | 1 ç‚¹ GMCï¼ˆå¹³ç§»ï¼‰å·²å®ç°ï¼Œ2/3 ç‚¹ä»¿å°„/é€è§†å˜æ¢æš‚æœªå®Œæ•´å®ç°             |
| é˜¶æ®µ 7: é«˜çº§åŠŸèƒ½       | âš ï¸ éƒ¨åˆ†   | 2026-02-16 | RVLC/Data Partitioning/äº¤é”™æ‰«æåŸºç¡€æ¡†æ¶å­˜åœ¨ï¼Œå®Œæ•´å®ç°éœ€ç‰¹å®šæµ‹è¯•æ ·æœ¬ |
| é˜¶æ®µ 8: æ€§èƒ½ + éªŒè¯    | âœ… å·²å®Œæˆ | 2026-02-16 | æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ138/138ï¼‰ï¼Œ0 Clippy è­¦å‘Šï¼Œä»£ç æ ¼å¼åŒ–ç¬¦åˆè§„èŒƒ          |

---

## 10. æœ¬æ¬¡æ‰§è¡Œæ€»ç»“ï¼ˆ2026-02-16ï¼‰

### å·²å®Œæˆçš„ä¿®å¤å’Œæ”¹è¿›

1. **é˜¶æ®µ 3: IDCT ç²¾åº¦æå‡**
    - æ”¹è¿›è¡Œå˜æ¢å’Œåˆ—å˜æ¢ï¼Œæ·»åŠ  rounding (+1024)
    - æå‡ IEEE 1180 å…¼å®¹æ€§ï¼Œå‡å°‘é‡åŒ–è¯¯å·®

2. **é˜¶æ®µ 4: è¿åŠ¨è¡¥å¿ä¿®å¤**
    - ä¿®å¤ P å¸§è‰²åº¦è¿åŠ¨è¡¥å¿ï¼Œæ·»åŠ å››åˆ†åƒç´ æ„ŸçŸ¥
    - ä¿®å¤ B å¸§ Direct æ¨¡å¼è‰²åº¦ MVï¼Œä½¿ç”¨ 4MV å¯¼å‡ºè€Œé 1MV

3. **é˜¶æ®µ 5: B å¸§é‡æ’åº**
    - å®ç°è§£ç å›¾åƒç¼“å†²åŒºï¼ˆDPBï¼‰
    - æ”¯æŒ B å¸§æŒ‰æ˜¾ç¤ºé¡ºåºè¾“å‡º
    - ä¿®å¤å¸§è¾“å‡ºé¡ºåºé—®é¢˜

4. **ä»£ç è´¨é‡**
    - 138 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
    - Clippy æ£€æŸ¥ 0 è­¦å‘Š
    - ä»£ç æ ¼å¼åŒ–ç¬¦åˆ rustfmt è§„èŒƒ

### éƒ¨åˆ†å®Œæˆçš„åŠŸèƒ½

1. **GMC (S-VOP)**
    - âœ… 1 ç‚¹ GMCï¼ˆå¹³ç§»ï¼‰å·²å®ç°
    - âš ï¸ 2/3 ç‚¹ GMCï¼ˆä»¿å°„/é€è§†å˜æ¢ï¼‰ä»…ç®€åŒ–ä¸ºå¹³ç§»
    - å®Œæ•´å®ç°éœ€è¦å¤æ‚çš„å‡ ä½•å˜æ¢è®¡ç®—

2. **é«˜çº§åŠŸèƒ½**
    - âš ï¸ RVLC åå‘è§£ç åŸºç¡€æ¡†æ¶å­˜åœ¨ï¼Œä½†æœªå®Œæ•´å®ç°
    - âš ï¸ Data Partitioning å­—èŠ‚çº§å¯å‘å¼åˆ†æå·²å®ç°
    - âš ï¸ äº¤é”™æ‰«æå­—æ®µè§£æå·²å®ç°ï¼Œåœºé¢„æµ‹+åœº DCT å¾…å®Œå–„

### æœªå®Œæˆçš„é«˜çº§ç‰¹æ€§ï¼ˆéœ€ç‰¹å®šæ ·æœ¬ï¼‰

è¿™äº›åŠŸèƒ½éœ€è¦ç‰¹å®šçš„æµ‹è¯•æ ·æœ¬æ‰èƒ½éªŒè¯å’Œå®Œå–„ï¼š

- RVLC å®Œæ•´åå‘è§£ç è·¯å¾„
- Data Partitioning å®Œæ•´åˆ†åŒºå¤„ç†
- äº¤é”™æ‰«æå®Œæ•´åœºé¢„æµ‹å’Œåœº DCT
- 2/3 ç‚¹ GMC ä»¿å°„/é€è§†å˜æ¢

### å»ºè®®åç»­å·¥ä½œ

1. **æ ·æœ¬æ”¶é›†**: ä» https://samples.ffmpeg.org/ æŸ¥æ‰¾åŒ…å«ä»¥ä¸‹ç‰¹æ€§çš„æ ·æœ¬ï¼š
    - RVLC ç¼–ç çš„ MPEG-4 æµ
    - Data Partitioning æ¨¡å¼çš„è§†é¢‘
    - äº¤é”™æ‰«æ MPEG-4 è§†é¢‘
    - 2/3 ç‚¹ GMC è§†é¢‘

2. **æ€§èƒ½ä¼˜åŒ–**:
    - SIMD ä¼˜åŒ–ï¼ˆIDCTã€è¿åŠ¨è¡¥å¿ï¼‰
    - å†…å­˜æ± å¤ç”¨
    - ç¼“å†²åŒºé¢„åˆ†é…

3. **å®Œå–„æµ‹è¯•**:
    - æ·»åŠ å®é™…æ ·æœ¬è§£ç æµ‹è¯•
    - ä¸ FFmpeg è¾“å‡ºå¯¹æ¯”éªŒè¯
    - PSNR/SSIM è´¨é‡æŒ‡æ ‡æµ‹è¯•
---

## æµ‹è¯•æ ·æœ¬æ”¶é›†ç»“æœ

> æ—¥æœŸ: 2026-02-16
> æ¥æº: https://samples.ffmpeg.org/archive/video/mpeg4/

### âœ… å·²æ‰¾åˆ°çš„é«˜çº§ç‰¹æ€§æ ·æœ¬

#### 1. GMC (Global Motion Compensation)

**ä¸»æ ·æœ¬:**

- **URL**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+++xvid_gmcqpel_artifact.avi
- **å¤§å°**: 2.8 MB
- **ç‰¹æ€§**: GMC + Quarterpel ç»„åˆï¼Œæµ‹è¯•å…¨å±€è¿åŠ¨è¡¥å¿çš„sprite warping
- **æè¿°æ–‡ä»¶**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+++xvid_gmcqpel_artifact.txt (6.8 KB)
- **ä¼˜å…ˆçº§**: â­â­â­ æœ€é«˜ï¼ˆç›´æ¥æµ‹è¯• GMC + QPel ç»„åˆï¼‰

**æ³¨æ„äº‹é¡¹:**

- æ­¤æ ·æœ¬å¯èƒ½åŒ…å« GMC ç›¸å…³ artifactï¼Œæ­£å¥½ç”¨äºæµ‹è¯•è¾¹ç•Œæƒ…å†µ
- ç»“åˆ QPel æµ‹è¯•ï¼ŒéªŒè¯é«˜çº§è¿åŠ¨è¡¥å¿è·¯å¾„

#### 2. Data Partitioning

**ä¸»æ ·æœ¬:**

- **URL**: https://samples.ffmpeg.org/archive/video/mpeg4/m4v+mpeg4+++ErrDec_mpeg4datapart-64_qcif.m4v
- **å¤§å°**: 287 KB
- **æ ¼å¼**: M4V (MPEG-4 Elementary Stream)
- **ç‰¹æ€§**: Data Partitioning æ¨¡å¼ï¼Œåˆ†åŒºé”™è¯¯å¤„ç†æµ‹è¯•
- **ä¼˜å…ˆçº§**: â­â­â­ æœ€é«˜ï¼ˆä¸“ç”¨ Data Partitioning æµ‹è¯•ï¼‰

**è¾…åŠ©æ ·æœ¬:**

- **URL**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+++vdpart-bug.avi
- **å¤§å°**: 180 KB
- **ç‰¹æ€§**: Data Partitioning bug æ ·æœ¬ï¼Œæµ‹è¯•è¾¹ç•Œæƒ…å†µ
- **æè¿°æ–‡ä»¶**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+++vdpart-bug.txt (283 å­—èŠ‚)
- **ä¼˜å…ˆçº§**: â­â­ é«˜ï¼ˆæµ‹è¯•å¼‚å¸¸å¤„ç†ï¼‰

#### 3. Quarterpel (å››åˆ†åƒç´ ) è¿åŠ¨è¡¥å¿

**ä¸»æ ·æœ¬:**

- **URL**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+++DivX51-Qpel.avi
- **å¤§å°**: 4.2 MB
- **ç‰¹æ€§**: DivX 5.01 Quarterpel è¿åŠ¨è¡¥å¿
- **é™„åŠ æ–‡ä»¶**: .tar.bz2 å‹ç¼©åŒ…ï¼ˆ269 KBï¼‰
- **æè¿°æ–‡ä»¶**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+++DivX51-Qpel.txt (573 å­—èŠ‚)
- **ä¼˜å…ˆçº§**: â­â­â­ æœ€é«˜

**è¾…åŠ©æ ·æœ¬:**

- **URL**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+++dx502_b_qpel.avi
- **å¤§å°**: 4.5 MB
- **ç‰¹æ€§**: DivX 5.02 B å¸§ + Quarterpel
- **æè¿°æ–‡ä»¶**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+++dx502_b_qpel.txt (57 å­—èŠ‚)
- **ä¼˜å…ˆçº§**: â­â­â­ æœ€é«˜ï¼ˆB å¸§ + QPel ç»„åˆï¼‰

- **URL**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+mp3++qpel-bframes.avi
- **å¤§å°**: 667 KB
- **ç‰¹æ€§**: Quarterpel + B å¸§
- **æè¿°æ–‡ä»¶**: https://samples.ffmpeg.org/archive/video/mpeg4/avi+mpeg4+mp3++qpel-bframes.txt (174 å­—èŠ‚)
- **é™„åŠ æ–‡ä»¶**: .tar.bz2 (502 KB)
- **ä¼˜å…ˆçº§**: â­â­ é«˜

### âŒ æœªæ‰¾åˆ°çš„ç‰¹æ€§æ ·æœ¬

#### RVLC (Reversible Variable Length Codes)

**æœç´¢ç»“æœ**: åœ¨æ•´ä¸ª samples.ffmpeg.org æ ·æœ¬åº“ä¸­æœªæ‰¾åˆ°åŒ…å« RVLC ç‰¹æ€§çš„ MPEG-4 æ ·æœ¬

**åˆ†æ:**

- RVLC æ˜¯ MPEG-4 ASP çš„å¯é€‰ç‰¹æ€§ï¼Œç”¨äºé”™è¯¯æ¢å¤
- å®é™…åº”ç”¨ä¸­å¾ˆå°‘ä½¿ç”¨ï¼ˆå¤§éƒ¨åˆ†ç¼–ç å™¨ä¸æ”¯æŒï¼‰
- FFmpeg ä¸­æœ‰ RVLC è§£ç ä»£ç ï¼Œä½†æµ‹è¯•æ ·æœ¬åº“ç¼ºå¤±

**æ›¿ä»£æ–¹æ¡ˆ:**

1. ä½¿ç”¨ FFmpeg è‡ªå¸¦çš„æµ‹è¯•å‘é‡ï¼ˆfate-suite å¯èƒ½åŒ…å«ï¼‰
2. ä½¿ç”¨ MPEG-4 å‚è€ƒè½¯ä»¶ç”Ÿæˆæµ‹è¯•æ ·æœ¬
3. æš‚æ—¶æç½® RVLC å®Œæ•´å®ç°ï¼Œä¿ç•™åŸºç¡€æ¡†æ¶

#### äº¤é”™æ‰«æ (Interlaced Field Prediction)

**æœç´¢ç»“æœ**: MPEG-4 ç›®å½•ä¸‹æœªæ‰¾åˆ°æ˜ç¡®çš„äº¤é”™æ‰«ææ ·æœ¬ï¼Œä½† MPEG-2 æœ‰å¤§é‡ interlaced æ ·æœ¬å¯å‚è€ƒ

**å¯èƒ½æ ·æœ¬ (éœ€éªŒè¯):**

- MPEG-2 interlaced æ ·æœ¬å¯èƒ½åŒ…å«ç±»ä¼¼çš„åœºé¢„æµ‹é€»è¾‘
- æŸäº› DivX/Xvid ç¼–ç çš„ AVI å¯èƒ½åŒ…å«äº¤é”™æ ‡å¿—

**å»ºè®®:**

- ä¼˜å…ˆä½¿ç”¨å·²æœ‰æ ·æœ¬æµ‹è¯•åŸºç¡€åŠŸèƒ½
- å¦‚éœ€å®Œæ•´äº¤é”™æ”¯æŒï¼Œå¯èƒ½éœ€è¦è‡ªè¡Œç”Ÿæˆæµ‹è¯•æ ·æœ¬

### ğŸ“‹ æ ·æœ¬ä½¿ç”¨è®¡åˆ’

#### é˜¶æ®µ 1: åŸºç¡€ç‰¹æ€§éªŒè¯

1. **Quarterpel éªŒè¯** (å·²éƒ¨åˆ†å®ç°)
    - ä½¿ç”¨ `DivX51-Qpel.avi` å’Œ `dx502_b_qpel.avi`
    - éªŒè¯åŠåƒç´  â†’ å››åˆ†åƒç´ çš„å·®å€¼ç²¾åº¦
    - æµ‹è¯• `qpel-bframes.avi` çš„ B å¸§ + QPel è·¯å¾„

2. **B å¸§é‡æ’åº** (å·²å®ç° DPB)
    - ä½¿ç”¨ `qprd_cmp_b-frames_naq1.avi` (5.6 MB)
    - éªŒè¯ DPB ç¼“å†²å’Œ FIFO è¾“å‡º

#### é˜¶æ®µ 2: é«˜çº§ç‰¹æ€§å®Œå–„

1. **GMC æµ‹è¯•**
    - ä½¿ç”¨ `xvid_gmcqpel_artifact.avi`
    - éªŒè¯ 1 ç‚¹ GMC (å·²å®ç°) å’Œ 2/3 ç‚¹ GMC (éœ€å®Œå–„)
    - å¯¹æ¯” FFmpeg è¾“å‡ºçš„ç²¾çµè¿åŠ¨è¡¥å¿ç»“æœ

2. **Data Partitioning**
    - ä½¿ç”¨ `ErrDec_mpeg4datapart-64_qcif.m4v`
    - å®ç°å®Œæ•´çš„ partition æ ‡è®°è§£æ
    - æµ‹è¯• `vdpart-bug.avi` çš„é”™è¯¯æ¢å¤è·¯å¾„

#### é˜¶æ®µ 3: è¾¹ç•Œæƒ…å†µä¸ç¨³å¥æ€§

1. **ä½åˆ†è¾¨ç‡å¤„ç†**
    - ä½¿ç”¨ `difficult_lowres.avi` (1.3 MB)
    - éªŒè¯è¾¹ç•Œæ‰©å±•å’Œ MV èŒƒå›´æ£€æŸ¥

2. **ç»„åˆç‰¹æ€§æµ‹è¯•**
    - `qpel-bframes.avi`: QPel + B å¸§
    - `xvid_gmcqpel_artifact.avi`: GMC + QPel
    - éªŒè¯å¤šç‰¹æ€§ç»„åˆçš„æ­£ç¡®æ€§

### ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¯ç”¨çš„æ ·æœ¬**:
    - âœ… GMC + QPel: `xvid_gmcqpel_artifact.avi`
    - âœ… Data Partitioning: `ErrDec_mpeg4datapart-64_qcif.m4v`
    - âœ… Quarterpel ç³»åˆ—: `DivX51-Qpel.avi`, `dx502_b_qpel.avi`

2. **æ›´æ–° SAMPLE_URLS.md**:
    - âœ… å·²æ·»åŠ æ‰€æœ‰æ‰¾åˆ°çš„é«˜çº§ç‰¹æ€§æ ·æœ¬
    - åŒ…å« URLã€å¤§å°ã€æè¿°æ–‡ä»¶é“¾æ¥

3. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**:
    - ä¸ºæ¯ä¸ªé«˜çº§ç‰¹æ€§åˆ›å»ºå•ç‹¬çš„æµ‹è¯•æ–‡ä»¶
    - ä½¿ç”¨ URL ç›´æ¥è§£ç ï¼Œåªæµ‹è¯•å‰ 10-20 å¸§
    - å¯¹æ¯” FFmpeg çš„ frame MD5 è¾“å‡º

4. **RVLC å’Œäº¤é”™æ‰«æ**:
    - æš‚æ—¶é™ä½ä¼˜å…ˆçº§ï¼ˆæ ·æœ¬ç¼ºå¤±ï¼‰
    - ä¿ç•™ç°æœ‰çš„è§£ææ¡†æ¶
    - å¾…æ‰¾åˆ°åˆé€‚æ ·æœ¬åå†å®Œå–„