# MPEG4 Part 2 è§£ç å™¨ PSNR éªŒè¯å·¥ä½œæµå®Œæˆæ€»ç»“

**å®Œæˆæ—¥æœŸ**: 2026-02-16  
**çŠ¶æ€**: âœ… éªŒè¯æ¡†æ¶å·²å®ç°å¹¶å¯è¿è¡Œ

---

## ğŸ“‹ ä»»åŠ¡å®Œæˆæƒ…å†µ

### å·²å®Œæˆé¡¹ç›®

| #   | ä»»åŠ¡                 | çŠ¶æ€ | æ–‡ä»¶                                      |
| --- | -------------------- | ---- | ----------------------------------------- |
| 1   | è‡ªåŠ¨åŒ– PSNR éªŒè¯è„šæœ¬ | âœ…   | `scripts/verify_mpeg4_psnr.py`            |
| 2   | è¯¦ç»†å·¥ä½œæµç¨‹æŒ‡å—     | âœ…   | `plans/PSNR_VERIFICATION_WORKFLOW.md`     |
| 3   | æ¼”ç¤ºéªŒè¯æŠ¥å‘Š         | âœ…   | `plans/MPEG4_PSNR_VERIFICATION_REPORT.md` |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1ï¸âƒ£ è‡ªåŠ¨åŒ– PSNR éªŒè¯è„šæœ¬

**æ–‡ä»¶**: `scripts/verify_mpeg4_psnr.py` (480+ è¡Œ)

#### ä¸»è¦åŠŸèƒ½

```bash
# è¿è¡Œå®Œæ•´éªŒè¯
python3 scripts/verify_mpeg4_psnr.py
```

**å·¥ä½œæµç¨‹**:

```
1. ç¯å¢ƒæ£€æŸ¥
   â”œâ”€ éªŒè¯ FFmpeg å¯ç”¨
   â”œâ”€ åˆ›å»ºå·¥ä½œç›®å½•
   â””â”€ æ£€æŸ¥ Python ç‰ˆæœ¬

2. å‚è€ƒåŸºçº¿ç”Ÿæˆ (3 ä¸ªæ ·æœ¬)
   â”œâ”€ color16.avi (312Ã—240)
   â”œâ”€ b-frames.avi (720Ã—480)
   â””â”€ Quarterpel.avi (320Ã—240)

3. Tao è§£ç  (å ä½ç¬¦å®ç°)
   â””â”€ è°ƒç”¨ tao-cli æˆ–åº“å‡½æ•°

4. PSNR è®¡ç®—
   â”œâ”€ é€å¸§è®¡ç®— Y/U/V å¹³é¢
   â”œâ”€ æ±‚å¹³å‡å€¼
   â””â”€ ç”Ÿæˆç»Ÿè®¡è¡¨

5. è´¨é‡å¯¹æ¯”
   â”œâ”€ ä¸é¢„æœŸé˜ˆå€¼æ¯”è¾ƒ
   â””â”€ åˆ¤æ–­ PASS/FAIL

6. æŠ¥å‘Šç”Ÿæˆ
   â””â”€ MPEG4_PSNR_VERIFICATION_REPORT.md
```

#### å…³é”®å‚æ•°

| å‚æ•°            | å€¼         |
| --------------- | ---------- |
| è´¨é‡é˜ˆå€¼ (åŸºç¡€) | >= 38.0 dB |
| è´¨é‡é˜ˆå€¼ (é«˜çº§) | >= 32.0 dB |
| æµ‹è¯•å¸§æ•°        | 10 å¸§      |
| è¶…æ—¶æ—¶é—´        | 5 åˆ†é’Ÿ     |

#### ç”Ÿæˆçš„è¾“å‡º

```
data/ffmpeg_baselines/
â”œâ”€â”€ ref_color16.yuv              (3.7 MB)
â”œâ”€â”€ ref_avi+mpeg4..._b-frames.yuv (4.9 MB)
â””â”€â”€ ref_avi+mpeg4..._Qpel.yuv     (3.7 MB)

data/mpeg4_decode_output/
â”œâ”€â”€ tao_color16.yuv              (è™šæ‹Ÿæ•°æ®)
â”œâ”€â”€ tao_avi+mpeg4..._b-frames.yuv (è™šæ‹Ÿæ•°æ®)
â””â”€â”€ tao_avi+mpeg4..._Qpel.yuv     (è™šæ‹Ÿæ•°æ®)

plans/
â””â”€â”€ MPEG4_PSNR_VERIFICATION_REPORT.md (è‡ªåŠ¨ç”Ÿæˆ)
```

#### æ‰§è¡Œç¤ºä¾‹ (æ¼”ç¤ºæ¨¡å¼)

```
[2026-02-16 17:21:06] INFO  MPEG4 Part 2 è§£ç å™¨ PSNR éªŒè¯å·¥å…·
[2026-02-16 17:21:06] INFO  æ£€æŸ¥ç¯å¢ƒ...
[2026-02-16 17:21:06] INFO  [OK] FFmpeg å¯ç”¨
[2026-02-16 17:21:06] INFO  [OK] å·¥ä½œç›®å½•å°±ç»ª
[2026-02-16 17:21:06] INFO
å¼€å§‹éªŒè¯ 3 ä¸ªæµ‹è¯•ç”¨ä¾‹...

[2026-02-16 17:21:06] INFO  ======================================================================
[2026-02-16 17:21:06] INFO  éªŒè¯: 1.1 åŸºç¡€ AVI è§£ç 
[2026-02-16 17:21:06] INFO  ç”Ÿæˆ FFmpeg åŸºçº¿: color16
[2026-02-16 17:21:11] INFO  [OK] å·²ç”Ÿæˆ (3.7 MB)
[2026-02-16 17:21:11] INFO  è¿è¡Œ tao-codec è§£ç : color16
[2026-02-16 17:21:11] INFO  [OK] å·²ç”Ÿæˆè™šæ‹Ÿè¾“å‡º
[2026-02-16 17:21:21] INFO  è®¡ç®— PSNR: ...
[2026-02-16 17:21:21] DEBUG   Frame  0: Y= 11.61 dB, U= 13.11 dB, V= 13.18 dB
...
[2026-02-16 17:21:21] WARN  [FAIL] å¤±è´¥! å¹³å‡ PSNR Y: 14.16 dB < 38.0 dB

[æ€»ä½“] é€šè¿‡: 0/3
```

---

### 2ï¸âƒ£ è¯¦ç»†å·¥ä½œæµç¨‹æŒ‡å—

**æ–‡ä»¶**: `plans/PSNR_VERIFICATION_WORKFLOW.md` (600+ è¡Œ)

#### å®Œæ•´çš„ 7 æ­¥å·¥ä½œæµ

**ç¬¬ 1 æ­¥: ç¯å¢ƒå‡†å¤‡**

- ç³»ç»Ÿè¦æ±‚æ£€æŸ¥
- FFmpeg/Python å®‰è£…
- å·¥ä½œç›®å½•åˆ›å»º

**ç¬¬ 2 æ­¥: ç”Ÿæˆå‚è€ƒåŸºçº¿**

- 3 ç§ç”Ÿæˆæ–¹å¼
- æ‰‹åŠ¨ ffmpeg å‘½ä»¤ç¤ºä¾‹
- éªŒè¯åŸºçº¿æ–‡ä»¶å®Œæ•´æ€§

**ç¬¬ 3 æ­¥: è¿è¡Œ Tao è§£ç **

- 3 ä¸ªå®ç°é€‰é¡¹
- tao-cli å‘½ä»¤è¡Œæ–¹æ¡ˆ
- Rust åº“é›†æˆæ–¹æ¡ˆ
- ä¸´æ—¶ FFmpeg å‚è€ƒæ–¹æ¡ˆ

**ç¬¬ 4 æ­¥: è®¡ç®— PSNR**

- ä½¿ç”¨ Python è„šæœ¬
- FFmpeg filter æ–¹å¼
- ImageMagick å¯¹æ¯”æ–¹å¼

**ç¬¬ 5 æ­¥: å¯¹æ¯”é˜ˆå€¼**

- è´¨é‡è¯„çº§æ ‡å‡†è¡¨
- æŒ‰æµ‹è¯•ç±»å‹çš„é˜ˆå€¼è¯´æ˜
- PSNR vs è´¨é‡å¯¹åº”å…³ç³»

**ç¬¬ 6 æ­¥: ç”ŸæˆæŠ¥å‘Š**

- è‡ªåŠ¨æŠ¥å‘Šç”Ÿæˆæµç¨‹
- æŠ¥å‘Šå†…å®¹ç¤ºä¾‹
- æŸ¥çœ‹å’Œä½¿ç”¨æŠ¥å‘Š

**ç¬¬ 7 æ­¥: åˆ†æå’Œæ”¹è¿›**

- æµ‹è¯•é€šè¿‡çš„å¤„ç†
- PSNR ä½æ—¶çš„è°ƒè¯•æ­¥éª¤
- é€å¸§åˆ†æå·¥å…·
- FFmpeg å¯¹æ ‡æ–¹æ³•

---

### 3ï¸âƒ£ æ¼”ç¤ºéªŒè¯æŠ¥å‘Š

**æ–‡ä»¶**: `plans/MPEG4_PSNR_VERIFICATION_REPORT.md`

è‡ªåŠ¨ç”Ÿæˆçš„æŠ¥å‘Šç¤ºä¾‹ï¼ŒåŒ…å«ï¼š

```markdown
# MPEG4 Part 2 è§£ç å™¨ PSNR éªŒè¯æŠ¥å‘Š

**éªŒè¯æ—¶é—´**: 2026-02-16 17:21:21

## æ‘˜è¦

| æŒ‡æ ‡     | ç»“æœ |
| -------- | ---- |
| æ€»æµ‹è¯•æ•° | 3    |
| é€šè¿‡æ•°   | 0    |
| å¤±è´¥æ•°   | 3    |
| é€šè¿‡ç‡   | 0.0% |

## è¯¦ç»†ç»“æœ

### Test 1: 1.1 åŸºç¡€ AVI è§£ç 

**çŠ¶æ€**: FAILED
**è´¨é‡é˜ˆå€¼**: PSNR Y >= 38.0 dB
**å¹³å‡ PSNR**: Y=14.16 dB, U=17.05 dB, V=19.22 dB
**é€å¸§æ•°æ®**: [10 è¡Œè¡¨æ ¼ï¼Œè¯¦ç»†åˆ°æ¯ä¸€å¸§]

## æ€»ä½“è¯„ä»·

âŒ **æµ‹è¯•é€šè¿‡ç‡ä½ã€‚** è§£ç å™¨éœ€è¦é‡ç‚¹ä¼˜åŒ–ã€‚
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€å°åŒ–å¯åŠ¨

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/tao

# 2. è¿è¡Œ PSNR éªŒè¯
python3 scripts/verify_mpeg4_psnr.py

# 3. æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Š
cat plans/MPEG4_PSNR_VERIFICATION_REPORT.md
```

### è¯¦ç»†æ­¥éª¤

```bash
# 1. å‡†å¤‡ç¯å¢ƒ
# - å®‰è£… FFmpeg: choco install ffmpeg (Windows)
# - éªŒè¯ Python: python3 --version

# 2. ç”Ÿæˆå‚è€ƒåŸºçº¿
# - æ–¹å¼ A: è¿è¡Œè„šæœ¬è‡ªåŠ¨ç”Ÿæˆ
python3 scripts/verify_mpeg4_psnr.py

# - æ–¹å¼ B: æ‰‹åŠ¨ç”Ÿæˆç‰¹å®šæ ·æœ¬
ffmpeg -i https://samples.ffmpeg.org/V-codecs/MPEG4/color16.avi \
  -pix_fmt yuv420p -f rawvideo -vframes 10 \
  data/ffmpeg_baselines/ref_color16.yuv

# 3. å®ç° tao-codec è§£ç è¾“å‡º
# - ç¼–è¾‘ tao-cli æˆ–åº“ï¼Œæ·»åŠ  YUV è¾“å‡ºé€‰é¡¹

# 4. é‡æ–°è¿è¡ŒéªŒè¯ (æ­¤æ—¶åº”æ˜¾ç¤ºå®é™… PSNR æ•°æ®)
python3 scripts/verify_mpeg4_psnr.py

# 5. åˆ†æç»“æœ
cat plans/MPEG4_PSNR_VERIFICATION_REPORT.md
```

### å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# ä»…ç”ŸæˆåŸºçº¿ (ä¸è¿è¡Œå®Œæ•´éªŒè¯)
cd data/ffmpeg_baselines
ffmpeg -i https://samples.ffmpeg.org/V-codecs/MPEG4/color16.avi \
  -pix_fmt yuv420p -f rawvideo -vframes 10 ref_color16.yuv

# è®¡ç®—ä¸¤ä¸ª YUV æ–‡ä»¶çš„ PSNR (ä½¿ç”¨ FFmpeg)
ffmpeg -i ref.yuv -i test.yuv -lavfi "[0:0][1:0]psnr=stats_file=psnr.log" \
  -f null - && cat psnr.log

# å¿«é€Ÿé¢„è§ˆ YUV æ–‡ä»¶
ffplay data/ffmpeg_baselines/ref_color16.yuv \
  -f rawvideo -pixel_format yuv420p -s 312x240 -framerate 25
```

---

## ğŸ“Š éªŒè¯çŸ©é˜µ

| æ–¹é¢        | çŠ¶æ€ | è¯´æ˜               |
| ----------- | ---- | ------------------ |
| è„šæœ¬ç¼–å†™    | âœ…   | 480 è¡Œå®Œæ•´ä»£ç      |
| FFmpeg é›†æˆ | âœ…   | è‡ªåŠ¨åŸºçº¿ç”Ÿæˆ       |
| PSNR è®¡ç®—   | âœ…   | Y/U/V å¹³é¢é€å¸§     |
| æŠ¥å‘Šç”Ÿæˆ    | âœ…   | Markdown è‡ªåŠ¨æ ¼å¼  |
| å·¥ä½œæµæ–‡æ¡£  | âœ…   | è¯¦ç»† 7 æ­¥æŒ‡å—      |
| æ•…éšœæ’é™¤    | âœ…   | 4 ä¸ªå¸¸è§é—®é¢˜       |
| æ¼”ç¤ºæ•°æ®    | âœ…   | å·²æˆåŠŸæ‰§è¡Œ         |
| æœªå®è£…      | â³   | tao-codec YUV è¾“å‡º |

---

## âš™ï¸ åç»­å®è£…æ­¥éª¤

### æ­¥éª¤ 1: æ‰©å±• tao-cli å‘½ä»¤ (ä¼˜å…ˆ)

```rust
// bins/tao-cli/src/main.rs

// æ–°å¢å‘½ä»¤è¡Œé€‰é¡¹
#[derive(Parser)]
struct Args {
    #[arg(short, long)]
    input: String,

    #[arg(long)]  // æ–°å¢
    output_raw: Option<String>,  // YUV æ–‡ä»¶è·¯å¾„

    #[arg(long)]  // æ–°å¢
    format: Option<String>,  // "yuv420p" ç­‰
}

// å®ç° YUV è¾“å‡º
fn output_raw_yuv(frames: Vec<Frame>, path: &str) -> Result<()> {
    let mut file = File::create(path)?;
    for frame in frames {
        match frame {
            Frame::Video(vf) => {
                file.write_all(&vf.data_y)?;      // Y å¹³é¢
                file.write_all(&vf.data_u)?;      // U å¹³é¢
                file.write_all(&vf.data_v)?;      // V å¹³é¢
            }
            _ => {}
        }
    }
    Ok(())
}
```

**ä½¿ç”¨æ–¹å¼**:

```bash
tao-cli --input color16.avi --output-raw color16.yuv --frames 10
```

### æ­¥éª¤ 2: æ›´æ–° Python è„šæœ¬

```python
# åœ¨ verify_mpeg4_psnr.py ä¸­å¯ç”¨çœŸå®è§£ç 

def generate_tao_decode(test_case: Dict) -> Tuple[bool, str]:
    # æ¢æˆçœŸå®è°ƒç”¨:
    cmd = [
        "./target/release/tao-cli",
        "--input", test_case["url"],
        "--output-raw", output_file,
        "--frames", str(test_case["frames"]),
    ]
    success, output = run_command(cmd, "è¿è¡Œ tao-codec è§£ç ")
    # ... éªŒè¯è¾“å‡º
```

### æ­¥éª¤ 3: è¿è¡Œå®Œæ•´éªŒè¯

```bash
# é‡æ–°ç¼–è¯‘ tao-cli
cargo build -p tao-cli --release

# è¿è¡Œå®Œæ•´éªŒè¯
python3 scripts/verify_mpeg4_psnr.py

# åº”æ˜¾ç¤ºå®é™… PSNR æ•°æ®ï¼Œè€Œéè™šæ‹Ÿæ•°æ®
```

---

## ğŸ“ˆ é¢„æœŸéªŒè¯ç»“æœ

### å¦‚æœè§£ç å™¨å®Œå…¨åŒ¹é… FFmpeg

```
Test 1.1 åŸºç¡€ AVI: PSNR Y â‰ˆ 100 dB (å®Œå…¨ç›¸åŒ)
Test 2.1 B å¸§:     PSNR Y â‰ˆ 100 dB (å®Œå…¨ç›¸åŒ)
Test 2.2 Quarterpel: PSNR Y â‰ˆ 100 dB (å®Œå…¨ç›¸åŒ)

æ€»ä½“è¯„ä»·: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

### å¦‚æœè§£ç å™¨æœ‰è½»å¾®å·®å¼‚

```
Test 1.1 åŸºç¡€ AVI: PSNR Y â‰ˆ 45-50 dB (æå¥½)
Test 2.1 B å¸§:     PSNR Y â‰ˆ 40-45 dB (å¾ˆå¥½)
Test 2.2 Quarterpel: PSNR Y â‰ˆ 35-40 dB (è‰¯å¥½)

æ€»ä½“è¯„ä»·: âœ… è´¨é‡å¯æ¥å— (å°‘äº 2% å·®å¼‚)
```

### å¦‚æœè§£ç å™¨æœ‰æ˜æ˜¾é—®é¢˜

```
Test 1.1 åŸºç¡€ AVI: PSNR Y â‰ˆ 25-30 dB (å¯æ¥å—ä½†æœ‰é—®é¢˜)
Test 2.1 B å¸§:     PSNR Y â‰ˆ 20-25 dB (ä¸¥é‡å·®å¼‚)
Test 2.2 Quarterpel: PSNR Y â‰ˆ 15-20 dB (éå¸¸å·®)

æ€»ä½“è¯„ä»·: âŒ éœ€è¦ä¿®å¤è§£ç å™¨
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

```
scripts/
â””â”€â”€ verify_mpeg4_psnr.py                     # 480+ è¡Œ Python è„šæœ¬

plans/
â”œâ”€â”€ PSNR_VERIFICATION_WORKFLOW.md            # 600+ è¡Œå·¥ä½œæµç¨‹æŒ‡å—
â”œâ”€â”€ MPEG4_PSNR_VERIFICATION_REPORT.md        # æ¼”ç¤ºæŠ¥å‘Š
â””â”€â”€ VERIFICATION_FRAMEWORK_COMPLETION_SUMMARY.md  # æ¡†æ¶å®Œæˆæ€»ç»“

data/
â”œâ”€â”€ ffmpeg_baselines/                        # è‡ªåŠ¨ç”Ÿæˆ
â”‚   â”œâ”€â”€ ref_color16.yuv
â”‚   â”œâ”€â”€ ref_b-frames.yuv
â”‚   â””â”€â”€ ref_qpel.yuv
â””â”€â”€ mpeg4_decode_output/                     # è‡ªåŠ¨ç”Ÿæˆ
    â”œâ”€â”€ tao_color16.yuv
    â”œâ”€â”€ tao_b-frames.yuv
    â””â”€â”€ tao_qpel.yuv
```

---

## ğŸ‰ æ€»ç»“

æœ¬é˜¶æ®µå®Œæˆäº† MPEG4 Part 2 è§£ç å™¨çš„å®Œæ•´ PSNR éªŒè¯æ¡†æ¶ï¼š

### âœ… å·²å®ç°

1. **è‡ªåŠ¨åŒ–è„šæœ¬** - å®Œæ•´çš„ Python PSNR éªŒè¯å·¥å…·
2. **è¯¦ç»†æ–‡æ¡£** - 7 æ­¥å·¥ä½œæµç¨‹æŒ‡å—
3. **æŠ¥å‘Šç”Ÿæˆ** - è‡ªåŠ¨æ ¼å¼åŒ–çš„éªŒè¯æŠ¥å‘Š
4. **æ¼”ç¤ºæ‰§è¡Œ** - è„šæœ¬å·²æˆåŠŸè¿è¡Œ

### â³ å¾…å®è£…

1. tao-cli æ·»åŠ  `--output-raw` é€‰é¡¹
2. å°†è™šæ‹Ÿæ•°æ®æ›¿æ¢ä¸ºçœŸå® tao-codec è¾“å‡º
3. é‡æ–°è¿è¡Œè„šæœ¬è·å¾—å®é™… PSNR æ•°æ®

### ğŸ’¡ æ„ä¹‰

- å»ºç«‹äº†é‡åŒ–è´¨é‡è¯„ä¼°ä½“ç³» (PSNR æŒ‡æ ‡)
- æ”¯æŒä¸ FFmpeg çš„ç›´æ¥å¯¹æ ‡
- è·Ÿè¸ªè§£ç å™¨ä¼˜åŒ–è¿›åº¦
- ä¸ºæ€§èƒ½åŸºå‡†æä¾›åŸºç¡€

---

## ğŸ“ åç»­æ­¥éª¤

1. **æœ¬å‘¨**: å®è£… tao-cli YUV è¾“å‡ºé€‰é¡¹
2. **ä¸‹å‘¨**: è¿è¡Œå®Œæ•´ PSNR éªŒè¯ï¼Œè·å¾—å®é™…æ•°æ®
3. **ä¼˜åŒ–**: æ ¹æ® PSNR ç»“æœï¼Œè¯†åˆ«å¹¶ä¿®å¤é—®é¢˜
4. **é›†æˆ**: å°† PSNR éªŒè¯æ·»åŠ åˆ° CI/CD æµç¨‹

---

**æäº¤**: 88f490f - `test: å®ç° MPEG4 Part 2 PSNR éªŒè¯å·¥ä½œæµ`

**ç»´æŠ¤è€…**: AI Copilot  
**æœ€åæ›´æ–°**: 2026-02-16
